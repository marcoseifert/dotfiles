#!/usr/bin/env ansible-playbook

- name: Bootstrap
  hosts: localhost
  vars:
    profile: core 
  pre_tasks:
  - name: Ensure directory structure wallah
    ansible.builtin.file:
      path: "~/.config/nix/"
      state: directory
      recurse: true

  - name: Create a file and write to it
    tags: all
    ansible.builtin.file:
      path: "~/.config/nix/nix.conf"
      state: touch

  - name: Add content to the file
    tags: all
    ansible.builtin.lineinfile:
      path: "~/.config/nix/nix.conf"
      line: "experimental-features = nix-command flakes"
      create: yes

  roles:
    - role: danielrolls.nix
      sudo: false
      nix_commands:
      - "nix run home-manager/release-23.11 switch -- switch --impure --flake .#{{ profile }}" 

